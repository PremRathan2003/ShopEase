{% extends "core/base.html" %}
{% load static %} 
{% block title%}Products{%endblock title %}
{% block content %}
<link
  href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
  rel="stylesheet"
/>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<!-- Update Product Modal -->
<div
  class="modal fade"
  id="updateModal"
  tabindex="-1"
  aria-labelledby="updateModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog">
    <div class="modal-content">
      <form
        id="update-form"
        method="POST"
        action="{% url 'update_product' 0 %}"
        enctype="multipart/form-data"
      >
        {% csrf_token %}
        <div class="modal-header">
          <h5 class="modal-title" id="updateModalLabel">Update Product</h5>
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="modal"
            aria-label="Close"
          ></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <label for="product-id" class="form-label">Id</label>
            <input type="text" class="form-control" name="id" id="product-id" />
          </div>

          <div class="mb-3 mt-2">
            <label for="product-name" class="form-label">Name</label>
            <input
              type="text"
              class="form-control"
              name="name"
              id="product-name"
            />
          </div>
          <div class="mb-3">
            <label for="product-price" class="form-label">Price</label>
            <input
              type="text"
              class="form-control"
              name="price"
              id="product-price"
            />
          </div>
          <div class="mb-3">
            <label for="product-image" class="form-label">Image</label>
            <input
              type="file"
              class="form-control"
              name="image"
              id="product-image"
            />
          </div>
          <div class="mb-3">
            <label for="product-seller" class="form-label">Seller</label>
            <input
              type="text"
              class="form-control"
              name="seller"
              id="product-seller"
            />
          </div>
        </div>
        <div class="modal-footer">
          <button
            type="button"
            class="btn btn-secondary"
            data-bs-dismiss="modal"
          >
            Cancel
          </button>
          <button type="submit" class="btn btn-danger">Delete</button>
        </div>
      </form>
    </div>
  </div>
</div>

<main>
  <section class="products">
    <h1>Our Products</h1>

    <form method="POST" action="{% url 'admin_search_products' %}">
      {% csrf_token %}
      <div class="search-bar">
        <input
          type="text"
          name="search"
          id="searchInput"
          placeholder="Search for products..."
          onkeyup="searchProducts()"
        />
        <button type="submit" class="search-icon">üîç</button>
      </div>
    </form>

    <div class="product-grid">
      <!-- Product Cards -->

      {% if products %} {% for product in products %}
      <div class="product-card">
        <img src="{{product.image.url}}" alt="Hair Dryer" />
        <h2>{{product.name}}</h2>
        <p class="brand">{{product.seller}}</p>
        <p class="price">‚Ç¨{{product.unit_price}}</p>
        <div class="rating">
          <span>4.0</span>
          <span class="star">‚òÖ</span>
        </div>

        <div class="d-flex justify-content-center">
          <!-- Update Product Button -->
          <button
            type="button"
            class="btn btn-warning"
            data-bs-toggle="modal"
            data-bs-target="#updateProductModal{{ product.id }}"
          >
            Update Product
          </button>

          <!-- Delete Product Button -->
          <form method="POST" action='{% url "delete_product" product.id %}'>
            {% csrf_token %}
            <button type="submit" class="btn btn-danger ms-1">
              Delete Product
            </button>
          </form>
        </div>
      </div>

      <!-- Update Product Modal -->
      <div
        class="modal fade"
        id="updateProductModal{{ product.id }}"
        tabindex="-1"
        aria-labelledby="updateProductLabel{{ product.id }}"
        aria-hidden="true"
      >
        <div class="modal-dialog">
          <div class="modal-content">
            <form action="{% url 'update_product' product.id %}" method="post">
              {% csrf_token %}
              <div class="modal-header bg-warning text-dark">
                <h5 class="modal-title" id="updateProductLabel{{ product.id }}">
                  Update Product
                </h5>
                <button
                  type="button"
                  class="btn-close"
                  data-bs-dismiss="modal"
                  aria-label="Close"
                ></button>
              </div>
              <div class="modal-body">
                <div class="mb-3">
                  <label for="productName{{ product.id }}" class="form-label"
                    >Product Name</label
                  >
                  <input
                    type="text"
                    class="form-control"
                    id="productName{{ product.id }}"
                    name="name"
                    value="{{ product.name }}"
                    required
                  />
                </div>
                <div class="mb-3">
                  <label for="productPrice{{ product.id }}" class="form-label"
                    >Price (‚Ç¨)</label
                  >
                  <input
                    type="number"
                    step="0.01"
                    class="form-control"
                    id="productPrice{{ product.id }}"
                    name="price"
                    value="{{ product.unit_price }}"
                    required
                  />
                </div>
                <div class="mb-3">
                  <label for="productSeller{{ product.id }}" class="form-label"
                    >Product Seller</label
                  >
                  <input
                    type="text"
                    class="form-control"
                    id="productSeller{{ product.id }}"
                    name="seller"
                    value="{{ product.seller }}"
                    required
                  />
                </div>
              </div>
              <div class="modal-footer">
                <button type="submit" class="btn btn-success">
                  Update Product
                </button>
                <button
                  type="button"
                  class="btn btn-secondary"
                  data-bs-dismiss="modal"
                >
                  Cancel
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>

      {% endfor %} {% else %}
      <div class="container">
        <div class="card">
          <h3>No data found!</h3>
        </div>
      </div>
      {% endif %}
    </div>
  </section>
</main>

{% endblock content %}
